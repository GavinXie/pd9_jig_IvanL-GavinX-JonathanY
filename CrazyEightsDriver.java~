public class CrazyEightsDriver{
    private Pile pile;
    private Card topCard;
    private ArrayList<Player> Players;
    private Deck deck;
    private String winningPlayer,type;
    private boolean winnarFound = false, counter;
    private int CurrentSuit,turn,stakes;
    public static void CreatePlayers(int number, int Comp){
	Players = new ArrayList<Player>();
	for (int i = 0; i < number; i++){
	    System.out.println("What is Player " + i + "'s name?");
	    Scanner Bob = new Scanner(System.in);
	    String s = Bob.getNextLine();
	    Player Aplayer = new Player(s);
	    System.out.println("Player " + i + " created, name is" + " " + s);
	    Players.add(Aplayer);
	}
	for (int i = 0; i < Comp; i++){
	    Players.add(new Player());
	}
    }    
    public static boolean playerTurn(Player a){
	if (counter){
	    System.out.println("Your Opponent has placed a " + type + ". The stakes are " + stakes + ". Will you counter it?");
	    int Response = ScannerProcessor.returnString("Y/N");
	    if (Response == 0){
		for (int i = 0; i < stakes; i++){
		    Card Drew = deck.drawCard();
		    a.UnoHand.add(Drew);
		    System.out.println("You Drew a " + Drew);
		}
		stakes = 0;
		counter = false;
		type = "";
		return;
	    }
	    else {
		if (type.equals("Ace")){
		    int acePos = -1;
		    for (int i = 0; i < a.UnoHand.size(); i++){
			if (a.UnoHand.get(i).getValue() == 1){
			    acePos = i;
			    break;
			}
		    }
		    if (acePos == -1){
			System.out.println("You can't counter this, drawing Cards...");
			for (int i = 0; i < stakes; i++){
			    Card Drew = deck.drawCard();
			    a.UnoHand.add(Drew);
			    System.out.println("You Drew a " + Drew);
			}
			stakes = 0;
			counter = false;
			type = ""
			return;
		    }
		    else{
			pile.add(a.UnoHand.remove(acePos));
			topCard = pile.getFirst();
			System.out.println("Please select a new suit");
			CurrentSuit = ScannerProcessor.returnSomething("Suits");
			stakes += 4;
			return;
		    }
		}
		else {
		    ArrayList<Card> canCounter = new ArrayList<Card>();
		    for (int i = 0; i<a.UnoHand.size(); i++){
			if (a.UnoHand.get(i).getValue() == 2 ||
			    a.UnoHand.get(i).getValue() == 1){
			    canCounter.add(a.UnoHand.get(i));
			}
		    }
		    if (canCounter.size() == 0){
			System.out.println("You can't counter this, drawing Cards...");
			for (int i = 0; i < stakes; i++){
			    Card Drew = deck.drawCard();
			    a.UnoHand.add(Drew);
			    System.out.println("You Drew a " + Drew);
			}
			stakes = 0;
			counter = false;
			type = "";
			return;			
		    }
		    else {
			System.out.println("These are your selectable counterable cards, choose one (0-position based)");
			System.out.println(canCounter);
			int range = ScannerProcessor.returnRange(0, canCounter.size() - 1);
			System.out.println("You are countering with a(n) " + canCounter.get(range));
			pile.add(a.UnoHand.remove(canCounter.get(range)));
			if (canCounter.get(range).getValue() == 1){
			    System.out.println("Please select a new suit");
			    CurrentSuit = ScannerProcessor.returnSomething("Suits");
			    stakes += 4;
			    topCard = pile.getFirst();
			    type = "Ace";
			    return;
			}
			else {
			    pile.add(canCounter.get(range));
			    stakes += 2;
			    topCard = pile.getFirst();
			    CurrentSuit = topCard.getSuit();
			}
		    }
		}
	    }
	}
	if (topCard.getValue() != 8 || topCard.getValue() != 1){
	    System.out.println("Current Card on top is " + topCard);
	}
	else {
	    System.out.println("An eight or ace was played, current accepted suit is " + deciper(CurrentSuit));
	}
	boolean HasCard = false;
	for (int i = 0; i< a.UnoHand.size(); i++){
	    if (a.UnoHand.get(i).getValue() == pile.getFirst().getValue() ||
		a.UnoHand.get(i).getSuit()==CurrentSuit){
		HasCard = true;
		break;
	    }
	}
	if (!HasCard){
	    Card Drew = deck.drawCard();
	    a.UnoHand.add(Drew);
	    System.out.println("You Drew a " + Drew);
	}
	System.out.println("Select a compatible card from your UnoHand (0-index position based)");
	try{
	    Scanner sc = new Scanner(System.in);
	    int pos = sc.nextInt();
	    Card Selected = a.UnoHand.get(pos);
	    if (Selected.getValue() == 8 || Selected.getValue() == 1){
		pile.add(a.UnoHand.remove(pos));
		Scanner suit  = new Scanner(System.in);
		String Timmy = suit.nextLine();
		if (Timmy.equalsIgnoreCase("Diamonds")){
		    CurrentSuit = 1;
		}
		else if (Timmy.equalsIgnoreCase("Clubs")){
		    CurrentSuit = 2;
		}
		else if (Timmy.equalsIgnoreCase("Hearts")){
		    CurrentSuit = 3;
		}
		else{
		    CurrentSuit = 4;
		}
		if (Selected.getValue() == 1){ // Draw 4
		    counter = true;
		    stakes += 4;
		    type = "Ace"
		}
	    }
	    else if (Selected.getValue() == pile.getFirst().getValue() ||
		     Selected.getSuit()==CurrentSuit){
		if(Selected.getValue() == 2){ //Draw 2
		    counter = true;
		    stakes += 2;
		    type = "two";
		}
		else if(Selected.getValue() == 11){ // Skip Card
		    turn++;
		}
		else if(Selected.getValue() == 12){ // Reverse Card
		    Reverse();
		}
		pile.add(a.UnoHand.remove(pos));
		CurrentSuit = pile.getFirst().getSuit();
	    }
	    else{
		System.out.print("Card can't be played");
		playerTurn(a);
		return;
	    }
	    if (a.UnoHand.isEmpty()){
		winnarFound = true;
		winningPlayer = a.getName();
		return;
	    }
	}
	catch(Exception e){
	    System.out.println("Failed to select card");
	    playerTurn(a);
	}

    }
    public static String decipher(int suit){
	if (suit == 1){
	    return "Diamonds";
	}else if (suit == 2){
	    return "Clubs";
	}else if (suit == 3){
	    return "Hearts";
	}else{
	    return "Spades";
	}
    }	     
    public static void computerTurn(Player AI){
	if (counter){
	    if (type.equals("Ace")){
		for (int i = 0; i < AI.UnoHand.size(); i++){
		    if (AI.UnoHand.get(i).getValue() == 1){
			pile.add(AI.UnoHand.remove(i));
			topCard = pile.getFirst();
			System.out.println("Computer Player has countered an ace!");
			stakes += 4;
			return;
		    }
		}
		System.out.println("Computer couldn't counter!");
		for (int i = 0; i < stakes; i++){
		    AI.UnoHand.add(deck.drawCard());
		}
		return;
	    }
	    else {
		for (int i = 0; i < AI.UnoHand.size(); i++){
		    if (AI.UnoHand.get(i).getValue() == 1 || AI.UnoHand.get(i).getValue() == 2){
			pile.add(AI.UnoHand.remove(i));
			topCard = pile.getFirst();
			if (topCard.getValue() == 1){
			    System.out.println("Computer Player has stopped playing around and countered with an ace!");
			    stakes += 4;
			    type = "Ace";
			    
			    
			    return;
			}
			else {
			    System.out.println("Computer Player has countered with a " + topCard);
			    stakes +=2;
			    return;
			}
		    }
		}
		System.out.println("Computer couldn't counter the two");
		for (int i = 0; i < stakes; i++){
		    AI.UnoHand.add(deck.drawCard());
		}
		return;
	    }
	}
	Card Remove;
	for (int i =0; i < AI.UnoHand.size(); i++){	 
	    if (AI.UnoHand.get(i).getValue() == topCard.getValue() || AI.UnoHand.get(i).getSuit() == CurrentSuit
		AI.UnoHand.get(i).getValue() == 8 || AI.UnoHand.get(i).getValue() == 1){
		Remove = AI.remove(i);
		pile.add(Remove);
		TopCard = Remove;
		break;
	    }
	}
	if (Remove == null){
	    AI.UnoHand.add(deck.drawCard());
	    System.out.println("Computer drew a card");
	    return;
	}
	if (Remove.getValue() == 8 || Remove.getValue() == 1){
	    CurrentSuit = (int)(Math.random() * 5);
	}
	if (Remove.getValue() == 1){
	    System.out.println("Computer has played an ace!");
	    counter = true;
	    stakes += 4;
	    type = "Ace";
	}
	else if (Remove.getValue() == 11){
	    System.out.println("Computer has played a Jack(Skip Card)!");
	    turn++;
	}
	else if (Remove.getValue() == 12){
	    System.out.println("Compputer has just flipped us upside down by playing a Queen(Reverse Card)!");
	    Reverse();
	}
	else if (Remove.getValue() == 2){
	    System.out.println("Computer has played a two!");
	    counter = true;
	    stakes += 2;
	    type = "two";
	}
    }
    public static void Reverse(){ // How do you reverse? Just add the players in the reverse order!
	ArrayList<Player> newPlayerOrder = new ArrayList<Player>();
	for (int i = Players.size() - 1; i >= 0; i--){
	    newPlayerOrder.add(Players.get(i));
	}
	Players = newPlayerOrder;
    }
	

		     
    public static void main(String[]args){
	System.out.println("How Many Human Players will there be? (4 max)");
	int Human = ScannerProcessor.returnRange(1,4);
	int Computer = 0;
	System.out.println("Spawning " + Human + " human players");
	if (Human != 4){
	    System.out.println("How many AI players wanted (Total amt of players can't exceed 4)");
	    Computer = ScannerProcessor.returnRange(0,4-Human);
	    if (Computer == 0){
		if (Human == 1){
		    System.out.println("One Computer Players will spawn since you're all alone!");
		    CreatePlayers(Human, 1);
		}
		else {
		    System.out.println("No Computer Players will spawn at all");
		    CreatePlayers(Human,0);
		}
	    }
	    else {
		System.out.println(Computer + " players will spawn");
		CreatePlayers(Human,Computer);
	    }
	}
	deck = new Deck();
	deck.shuffle();
	for (int i = 0; i<Players.size(); i++){
	    for (int j = 0; j < 5; j++){
		Players.get(i).add(deck.drawCard());
	    }
	}
	topCard = deck.draw();
	CurrentSuit = topCard.getSuit();
	thePile.add(topCard);
	while (!winnarFound){
	    for (int i = 0; i < Players.size(); i++){
		if (winnarFound){
		    break;
		}
		Player CurrentPlayer = Players.get(turn%Players.size());
		if (CurrentPlayer.getName().equals("Comp")){
		    computerTurn(CurrentPlayer);
		}
		else {
		    playerTurn(CurrentPlayer);
		}
		turn++;
	    }
	}
	if (winningPlayer.equals("Comp")){
	    System.out.println("GAME OVER, RISE OF COMPUTER");
	}
	else {
	    System.out.println("Congratulations " + winningPlayer + " you are the Crazy Eights Champ!");
	}
    }
}
